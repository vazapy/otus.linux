\# High Availability Linux Infrastructure (OTUS.Linux)



Проект отказоустойчивой инфраструктуры с балансировкой нагрузки и репликацией MySQL.

Предназначен для быстрого развертывания на чистых серверах.


1\. \*\*Load Balancer (Nginx)\*\*: Входная точка (IP .20), распределяет трафик между серверами.

2\. \*\*Master Server (MySQL + Web)\*\*: Основная БД (Write/Read) + веб-сервер (IP .18).

3\. \*\*Slave Server (MySQL + Web)\*\*: Реплика БД (Read Only) + веб-сервер (IP .19).


\## Быстрый старт (Инструкция для развертывания)

\### Требования

\* 3 чистые виртуальные машины (Ubuntu 20.04/22.04) с доступом в интернет.

\* Установленный Docker и Docker Compose.



\### Шаг 1: Подготовка серверов

Клонируйте этот репозиторий на каждую машину или скопируйте соответствующие папки:

\* На машину 1: папка `vm-balancer`

\* На машину 2: папка `vm-master`

\* На машину 3: папка `vm-slave`



\### Шаг 2: Запуск (выполнять на каждой машине)

Зайдите в папку и выполните команду:

cd vm-balancer
sudo docker compose up -d


cd vm-master
sudo docker compose up -d


cd vm-slave
sudo docker compose up -d


\### Шаг 3:  Настройка репликации и бэкапов

1\. Настройка Мастера (Server 2) 

Репликация настраивается автоматически через перенос "умного бэкапа", который содержит координаты бин-лога.


\# Создание бэкапа для инициализации репликации

cd vm-master
./scripts/backup.sh


После выполнения запомните имя созданного файла (например: full\_backup\_2026-01-09...sql).
Полученный файл .sql нужно передать на Slave-сервер.


Находясь на Master сервере, отправляем файл на Slave, сразу переименовывая его в dump.sql для удобства. (Замените user на ваше имя пользователя, а имя файла бэкапа — на то, что создалось выше):

scp backups/full\_backup\_XXXXXX.sql user@192.168.1.19:~/vm-slave/dump.sql


2\. Настройка Слейва (Server 3) Перенесите файл бэкапа на эту машину и запустите восстановление:

cd vm-slave

\# Скрипт сам настроит Master\_Log\_File и Position

./scripts/restore.sh dump.sql


Проверка работоспособности

Откройте IP балансировщика в браузере. Страница должна меняться (Master <-> Slave).



1\. Проверка репликации (MySQL)

Зайдите внутрь контейнера базы данных на Slave сервере: (пароль root)

sudo docker exec -it db-slave mysql -u root -p

Внутри MySQL выполните команду:

SHOW SLAVE STATUS \\G



Убедитесь, что в выводе есть две заветные строки:


Slave\_IO\_Running: Yes

Slave\_SQL\_Running: Yes

